<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Cold Center Terminal</title>
    <link
      href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css"
    />
    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <style>
      #map {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const key = 'hMTdUv602spvwVDfuykt'; // Your MapTiler API key

      // Initialize the map source using TileJSON
      const source = new ol.source.TileJSON({
        url: `https://api.maptiler.com/maps/streets-v2/tiles.json?key=${key}`, // MapTiler TileJSON URL
        tileSize: 512,
        crossOrigin: 'anonymous',
      });

      // Initialize the map
      const map = new ol.Map({
        target: 'map', // The id of the element to render the map
        layers: [
          new ol.layer.Tile({
            source: source,
          }),
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([106.660172, 10.762622]), // Default starting position [lng, lat]
          zoom: 9, // Starting zoom
        }),
      });

      // Fetch data from PHP backend
      fetch('data.php', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          longitude: 30.2145,
          latitude: 62.123,
          height: 123.45,
          status: 0,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.longitude && data.latitude) {
            const {longitude, latitude} = data;
            const markerElement = document.createElement('div');
            markerElement.className = 'marker';

            const marker = new ol.Overlay({
              position: ol.proj.fromLonLat([longitude, latitude]),
              positioning: 'center-center',
              element: markerElement,
              stopEvent: false,
            });
            map.addOverlay(marker);
          } else {
            console.error('Failed to retrieve coordinates from server.');
          }
        })
        .catch((error) => {
          console.error('Error fetching data:', error);
        });
    </script>
  </body>
</html>
